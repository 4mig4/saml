<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
   "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<head>
    <title>lua-resty-saml documentation</title>
    <link rel="stylesheet" href="../ldoc_pale.css" type="text/css" />
</head>
<body>

<div id="container">

<div id="product">
	<div id="product_logo"></div>
	<div id="product_name"><big><b></b></big></div>
	<div id="product_description"></div>
</div> <!-- id="product" -->


<div id="main">


<!-- Menu -->

<div id="navigation">
<br/>
<h1>lua-resty-saml</h1>

<ul>
  <li><a href="../index.html">Index</a></li>
</ul>

<h2>Contents</h2>
<ul>
<li><a href="#Dependencies">Dependencies </a></li>
<li><a href="#Download">Download </a></li>
<li><a href="#Initialization">Initialization </a></li>
<li><a href="#Shutdown">Shutdown </a></li>
</ul>


<h2>Topics</h2>
<ul class="">
  <li><a href="../topics/00-Introduction.md.html">00-Introduction</a></li>
  <li><strong>01-Installation</strong></li>
  <li><a href="../topics/02-Organization.md.html">02-Organization</a></li>
</ul>
<h2>Modules</h2>
<ul class="nowrap">
  <li><a href="../modules/resty.saml.binding.html">resty.saml.binding</a></li>
  <li><a href="../modules/resty.saml.html">resty.saml</a></li>
  <li><a href="../modules/saml.html">saml</a></li>
</ul>
<h2>Examples</h2>
<ul class="nowrap">
  <li><a href="../examples/identity_provider.lua.html">identity_provider.lua</a></li>
  <li><a href="../examples/service_provider.lua.html">service_provider.lua</a></li>
  <li><a href="../examples/utils.lua.html">utils.lua</a></li>
</ul>

</div>

<div id="content">


<h1>Installation</h1>

<p><a name="Dependencies"></a></p>
<h2>Dependencies</h2>

<p>At compile time:</p>

<ul>
    <li>libxml2</li>
    <li>xmlsec1, plus a supported crypto library</li>
</ul>

<p>At run time (for the binding module):</p>

<ul>
    <li>lua-nginx-module</li>
    <li>zlib and lua-zlib</li>
</ul>

<p>The version of xmlsec1 that is packaged in the Centos repo is quite old, hence why the development container compiles it from source.</p>

<p>The compiler flags, notably which crypto backend is used by xmlsec1, are generated via the <code>xmlsec1-config</code> binary, which is usually installed as part of the linux package for the library.  If you are having issues with any crypto-related functions, such as loading a key, it may be because xmlsec1 cannot determine the correct options based on your file system layout.</p>


<p><a name="Download"></a></p>
<h2>Download</h2>

<h3>LuaRocks</h3>

<p><a href="https://github.com/luarocks/luarocks/wiki/Download">Install LuaRocks</a>, then</p>


<pre>
luarocks install lua-resty-saml
</pre>


<h3>Make</h3>


<pre>
git clone https://github.com/megalord/lua-resty-saml &amp;&amp; cd lua-resty-saml
make install INST_LIBDIR=&lt;lua cpath&gt; INST_LUADIR=&lt;lua path&gt; INST_CONFDIR=&lt;rock_dir&gt;
</pre>


<p>The <code>path</code> and <code>cpath</code> can be found via</p>

<pre>
lua -e <span class="string">'print("path: " .. package.path); print("cpath: " .. package.cpath)'</span>
</pre>


<p>The <code>rock_dir</code> can be anything, and whatever it is should be passed to <a href="../modules/saml.html#init">saml.init</a>.</p>

<p><a name="Initialization"></a></p>
<h2>Initialization</h2>

<p>The <a href="../modules/saml.html#init">saml.init</a> function initializes the libxml2 and xmlsec1 libraries as well as some static data defined by this library.  It should be called before any other functions and only once per process, i.e. in the <code>init_by_lua</code> phase for OpenResty (not <code>init_worker_by_lua</code>).</p>

<p>It takes a mandatory table with a few key/value pairs:</p>

<h3>debug</h3>

<p>Optional boolean, defaults to false</p>

<p>Set this to true for extra debugging information to be sent to stderr.  This information can come from libxml2, xmlsec1, and this library, so it can get a bit noisy.  It is often most helpful when troubleshooting signature or document parsing errors.</p>

<h3>rock_dir</h3>

<p>Required string</p>

<p>Indicates the path to the installed Lua rock.  It is necessary because this library bundles the SAML XSD schemas internally (to prevent them being fetched over the network at runtime).  If using OpenResty, this is likely <code>/usr/local/openresty/luajit/lib/luarocks/rocks/lua-resty-saml/&lt;version&gt;/</code>.</p>


<p><a name="Shutdown"></a></p>
<h2>Shutdown</h2>

<p>There is a <a href="../modules/saml.html#shutdown">saml.shutdown</a> function, but you won't need it in the context of OpenResty because the OS will clean up when the nginx process finishes.</p>


</div> <!-- id="content" -->
</div> <!-- id="main" -->
<div id="about">
<i>generated by <a href="http://github.com/stevedonovan/LDoc">LDoc 1.4.6</a></i>
<i style="float:right;">Last updated 2019-06-17 19:51:24 </i>
</div> <!-- id="about" -->
</div> <!-- id="container" -->
</body>
</html>
